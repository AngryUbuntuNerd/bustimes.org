{% extends 'page.html' %}

{% block title %}{% firstof query 'Search' %} â€“ bustimes.org{% endblock %}

{% block content %}

<h1>Search</h1>

<form method="get" action="/search" class="search">

<p>{{ form.q }} <input type="submit" value="Search"></p>

</form>

{% if query %}
    {% with postcode=form.get_postcode %}
        {% if postcode %}
            <h2>Postcode {{ query.upper }}</h2>
            <ul>
                {% for locality in postcode %}
                    <li><a href="{{ locality.get_absolute_url }}">{{ locality.get_qualified_name }}</a></li>
                {% endfor %}
            </ul>
        {% endif %}
        {% if not postcode or page.object_list %}

            <h2>{{ localities.paginator.count }} place{{ localities.paginator.count|pluralize }}</h2>

            {% if localities %}
                <ul class="has-smalls">
                    {% for result in localities %}
                        <li>
                            <a href="{{ result.get_absolute_url }}">
                                {{ result.get_qualified_name }}
                            </a>
                        </li>
                    {% endfor %}
                </ul>
                {% if localities.has_previous %}
                    <p class="previous"><a href="?q={{ query }}&amp;page={{ localities.previous_page_number }}" rel="prev">&larr; Page {{ localities.previous_page_number }}</a>
                {% endif %}

                {% if localities.paginator.has_next %}
                    <p class="next"><a href="?q={{ query }}&amp;page={{ localities.next_page_number }}" rel="next">Page {{ localities.next_page_number }} &rarr;</a>
                {% endif %}

            {% endif %}

            <h2>{{ operators.paginator.count }} operator{{ operators.paginator.count|pluralize }}</h2>

            {% if operators %}
                <ul class="has-smalls">
                    {% for result in operators %}
                        <li>
                            <a href="{{ result.get_absolute_url }}">
                                {{ result }}
                            </a>
                        </li>
                    {% endfor %}
                </ul>

                {% if operators.has_previous %}
                    <p class="previous"><a href="?q={{ query }}&amp;page={{ operators.previous_page_number }}" rel="prev">&larr; Page {{ operators.previous_page_number }}</a>
                {% endif %}

                {% if operators.has_next %}
                    <p class="next"><a href="?q={{ query }}&amp;page={{ operators.next_page_number }}" rel="next">Page {{ operators.next_page_number }} &rarr;</a>
                {% endif %}

            {% endif %}

            <h2>{{ services.paginator.count }} service{{ services.paginator.count|pluralize }}</h2>

            {% if services %}
                <ul class="has-smalls">
                    {% for result in services %}
                        <li>
                            <a href="{{ result.get_absolute_url }}">
                                <span>{% firstof result.get_qualified_name result %}</span>
                                {% if result.operator %}<small>{{ result.operator.all|join:", " }}</small>{% endif %}
                            </a>
                        </li>
                    {% endfor %}
                </ul>

                {% if services.has_previous %}
                    <p class="previous"><a href="?q={{ query }}&amp;page={{ services.previous_page_number }}" rel="prev">&larr; Page {{ services.previous_page_number }}</a>
                {% endif %}

                {% if services.has_next %}
                    <p class="next"><a href="?q={{ query }}&amp;page={{ services.next_page_number }}" rel="next">Page {{ services.next_page_number }} &rarr;</a>
                {% endif %}
            {% endif %}

        {% endif %}
    {% endwith %}
{% endif %}


{% endblock %}
