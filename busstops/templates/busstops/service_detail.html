{% extends 'page.html' %}

{% block content %}

<h1>{{ object }}</h1>

<p>
    {{ object.get_a_mode }}
    service
    {% if operators %}
        operated by
        {% for operator in operators %}{% if not forloop.first %}{% if forloop.last %} and {% else %}, {% endif %}{% endif %}<a href="{{ operator.get_absolute_url }}">{{ operator }}</a>{% endfor %}
    {% endif %}
</p>

{% if operators.0.id == 'MEGA' %}
    <p><a href="https://www.awin1.com/awclick.php?mid=2678&amp;id=242611" rel="nofollow">Buy tickets from Megabus</a></p>
{% endif %}

{% if traveline_url %}

    <p><a href="{{ traveline_url }}" rel="nofollow">View timetable
        {% if object.net == 'tfl' %}
            on the Transport for London
        {% elif object.region_id == 'S' %}
            (PDF) on the Traveline Scotland
        {% else %}
            on the Traveline
        {% endif %}
    website</a></p>

{% endif %}

{% for timetable in timetables %}
    {% for grouping in timetable.groupings %}{% if grouping.journeys %}
    <h2>{{ grouping.direction.capitalize }} {{ timetable.operating_period }}</h2>

    <div class="timetable-wrapper">
    {% if grouping.has_minor_stops %}
        <input type="checkbox" id="show-all-stops-{{ forloop.parentloop.counter }}-{{ forloop.counter }}" />
        <label for="show-all-stops-{{ forloop.parentloop.counter }}-{{ forloop.counter }}">Show all stops</label>
    {% endif %}
    <table class="timetable">
    <tbody>
    <tr><td></td>
    {% for column in grouping.column_heads %}
        <td colspan="{{ column.span }}">{% firstof column.operatingprofile timetable.operating_profile as operatingprofile %}{{ operatingprofile|linebreaksbr }}</td>
    {% endfor %}
    </tr>
    {% for row in grouping.rows %}
        <tr class="{{ row.part.timingstatus }}"><th>
        {% if row.part.stop.stop %}
            <a href="{{ row.part.stop.stop.get_absolute_url }}">{{ row.part.stop.stop.get_qualified_name }}</a>
        {% else %}{{ row.part.stop }}{% endif %}
        </th>
        {% for time in row.times %}
            <td>{{ time }}</td>
        {% endfor %}
        </tr>
    {% endfor %}
    </tbody>
    <tfoot><tr><td></td>
    {% for column in grouping.column_feet %}
        <td colspan="{{ column.span }}">{{ column.notes|join:'<br />'|urlize }}</td>
    {% endfor %}
    </tr></tfoot>
    </table>
    </div>
    {% endif %}{% endfor %}
    <p>Traveline National Dataset, {{ service.date }}</p>
{% empty %}

<div class="map-wrapper"><div id="map"></div></div>

{% for stopusage in stopusages %}
{% ifchanged stopusage.direction %}
    {% if not forloop.first %}</ul>{% endif %}
    <h2>{{ stopusage.direction.capitalize }}</h2>
    <input type="checkbox" id="show-all-stops-{{ forloop.counter }}" />
    <label for="show-all-stops-{{ forloop.counter }}">Show all stops</label>
    <ul class="route">
{% endifchanged %}
    <li class="{{ stopusage.timing_status }}" itemscope itemtype="https://schema.org/BusStop">
        <a href="{{ stopusage.stop.get_absolute_url }}">
            <span itemprop="name">{{ stopusage.stop.get_qualified_name }}</span>
            <span itemprop="geo" itemscope itemtype="https://schema.org/GeoCoordinates">
                <meta itemprop="latitude" content="{{ stopusage.stop.latlong.y }}" />
                <meta itemprop="longitude" content="{{ stopusage.stop.latlong.x }}" />
            </span>
        </a>
    </li>
{% endfor %}
</ul>

{% endfor %}

{% endblock %}
