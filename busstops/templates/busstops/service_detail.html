{% extends 'page.html' %}

{% load urlise %}

{% block content %}

<h1>{{ object }}</h1>

<p>
    {{ object.get_a_mode }}
    service
    {% if operators %}
        operated by
        {% for operator in operators %}{% if not forloop.first %}{% if forloop.last %} and {% else %}, {% endif %}{% endif %}<a href="{{ operator.get_absolute_url }}">{{ operator }}</a>{% endfor %}
    {% endif %}
</p>

{% for note in notes %}
    <p class="warning">{{ note|safe }}</p>
{% endfor %}

{% if object.service_code == 'swe_31-899-_-y10' or object.service_code == 'swe_31-899-A-y10' %}
<pre>Monday - Saturday (Except Public Holidays)

                             SD                  SD   NS
SEATON, Marine Place        0810 0930 1150 1350 1430 1615
BEER, Cross                 0817 0937 1157 1357 1437 1622
BEER, Underleys              -   0940 1200 1400  -   1625
THREE HORSE SHOES, Inn      0823  -    -    -   1443  -
BRANSCOMBE, Village Hall     -   0953 1213 1413  -   1638
SIDFORD, Spar               0829  -   1225 1425 1449 1650
FORTESCUE, Phone Box         -   1005  -    -    -    -
SIDMOUTH COLLEGE            0838  -    -    -    -    -
SIDMOUTH Triangle, Stop C   0850 1013 1233 1433 1457 1658

                             SD                  SD   NS
SIDMOUTH, Triangle Stop C   0910 1030 1250 1450  -   1705
SIDMOUTH COLLEGE             -    -    -    -   1530  -
SIDFORD, Spar               0918 1038  -   1458 1535 1713
FORTESCUE, Phone Box         -    -   1258  -    -    -
BRANSCOMBE, Village Hall     -   1050 1310 1510  -   1725
THREE HORSE SHOES, Inn      0925  -    -    -   1542  -
BEER, Underleys              -   1103 1323 1523  -   1738
BEER, Cross                 0931 1108 1326 1526 1548 1741
SEATON, Sea Front Gardens   0938 1113 1333 1533 1555 1748

CODE: SD - SCHOOLDAYS ONLY
      NS - NOT SATURDAY

Certain journeys on this service are financially supported by Devon County Council</pre>
{% elif object.service_code == 'swe_31-899-B-y10' %}
<pre>Schooldays Only

SEATON, Sea Front Gardens 0805 1500
AXMOUTH, Ship Inn         0809 1514
ROUSDON, Garage           0821 1526
WOODROFFE SCHOOL          0830 1532
WOODROFFE SCHOOL          0835 1546
ROUSDON, Garage           0843 1552
AXMOUTH, Ship Inn         0849 1558
SEATON Sea Front          0853 1602</pre>
{% elif object.service_code == 'swe_31-885-_-y10' %}
<pre>                                  NS                                      NS             S    NS
BEER Underleys                    -    -    -   1001  -   1201  -   1401  -        1701  -    -    -
BEER Cross                        -   0750  -   1004 1100 1204 1300 1404 1500  -   1704 1800 1800 1855
SEATON, Sea Front Gardens Arrive  -   0758  -   1012 1108 1212 1308 1412 1508  -   1712 1808 1808 1903
SEATON, Sea Front Gardens Depart 0645 0800 0920 1020 1120 1220 1320 1420 1520 1620 1720  -   1810  -
SEATON, Health Centre            0650 0804 0924 1024 1124 1224 1324 1424 1524 1624 1724  -   1814  -
COLYFORD, The Elms               0652 0807 0927 1027 1127 1227 1327 1427 1527 1627 1727  -   1817  -
COLYTON, Square                  0656 0811 0931 1031 1131 1231 1331 1431 1531 1631 1731  -   1821  -
WHITFORD, Hampton Lane           0701 0815 0935 1035 1135 1235 1335 1435  -   1635 1735  -   1825  -
MUSBURY, Garage                  0704 0818 0938 1038 1138 1238 1338 1438  -   1638 1738  -   1828  -
AXMINSTER, Rail Station †        0711 0825 0945 1045 1145 1245 1345 1445  -   1645 1745  -   1835  -
AXMINSTER, Trinity Square Stop B 0714 0827 0950 1050 1150 1250 1350 1450  -   1650 1750  -   1837  -
MILLWEY RISE, Second Avenue      0719  *   0955 1055 1155 1255 1355 1455  -   1655 1755  -    -    -
                                                                                       *
                                       NS        NS   S                                                 NS
MILLWEY RISE, Second Avenue       -   0725  -    -    -   1005 1105 1205 1305 1405  -    -   1705 1805  -
AXMINSTER, Trinity Square Stop A  -   0730 0835 0910  -   1010 1110 1210 1310 1410 1530  -   1710 1810 1840
AXMINSTER, Rail Station †         -   0732 0840 0915  -   1015 1115 1215 1315 1415 1535  -   1715 1815 1842
MUSBURY, Garage                   -   0739 0847 0922  -   1022 1122 1222 1322 1422 1542  -   1722 1822 1849
WHITFORD, Hampton Lane            -   0742 0850 0925  -   1025 1125 1225 1325 1425 1545  -   1725 1825 1852
COLYTON, Square                   -   0746 0855 0930  -   1030 1130 1230 1330 1430 1550  -   1730 1830 1856
COLYFORD, The Elms                -   0750 0859 0934  -   1034 1134 1234 1334 1434 1554  -   1734 1834 1900
SEATON, Health Centre             -   0753 0902 0937  -   1037 1137 1237 1337 1437 1557  -   1737 1837 1903
SEATON, Marine Place      Arrive  -   0800 0909 0944  -   1044 1144 1244 1344 1444 1604  -   1744 1844 1910
SEATON, Marine Place      Depart 0740  -    -   0950 0950 1050 1150 1250 1350 1450  -   1650 1750 1845  -
BEER Cross                       0748  -    -   0958 0958 1058 1158 1258 1358 1458  -   1658 1758 1853  -
BEER Underleys                    -    -    -   1001 1001  -   1201  -   1401  -    -   1701  -    -    -

CODE: NS - NOT SATURDAY
       * - CONTINUES TO/COMMENCES FROM AXE VALLEY SCHOOL ON SCHOOLDAYS
       † - STOPS CLOSE TO RAIL STATION
       S - SATURDAY ONLY

Certain journeys are financially supported by Devon County Council</pre>
{% else %}

{% for timetable in timetables %}
    <form class="timetable-date">
        <select onchange="this.form.submit()" name="date">
            {% for option in timetable.date_options %}
                <option{% if option.date == timetable.date %} selected{% endif %} value="{{ option.date.isoformat }}">{{ option.day }} {{ option.date }}</option>
            {% endfor %}
        </select>
        <noscript><input type="submit" /></noscript>
    </form>

    {% for grouping in timetable.groupings %}
    <h2>{{ grouping }} {{ timetable.operating_period }}</h2>

    <div class="timetable-wrapper-wrapper">
    {% if grouping.has_minor_stops %}
        <input type="checkbox" id="show-all-stops-{{ forloop.parentloop.counter }}-{{ forloop.counter }}" />
        <label for="show-all-stops-{{ forloop.parentloop.counter }}-{{ forloop.counter }}">Show all stops</label>
    {% endif %}
    <div class="timetable-wrapper">
    <table class="timetable">
    <tbody>
    {% for row in grouping.rows %}
        <tr class="{{ row.part.timingstatus }}"><th>
        {% if row.part.stop.stop %}
            <a href="{{ row.part.stop.stop.get_absolute_url }}">{{ row.part.stop.stop.get_qualified_name }}</a>
        {% else %}{{ row.part.stop }}{% endif %}
        </th>
        {% for cell in row.times %}
            {% if cell.colspan %}
                <td colspan="{{ cell.colspan }}" rowspan="{{ cell.rowspan }}">{{ cell }}</td>
            {% else %}
                <td>{{ cell }}</td>
            {% endif %}
        {% endfor %}
        </tr>
    {% endfor %}
    </tbody>
    {% if grouping.column_feet %}
        <tfoot>
        {% for row in grouping.column_feet.values %}
            <tr><td></td>{% for foot in row %}<td{% if foot.span > 1 %} colspan="{{ foot.span }}"{% endif %}>{% if foot.notes %}{{ foot.notes|urlise }}{% endif %}</td>{% endfor %}</tr>
        {% endfor %}
        </tfoot>
    {% endif %}
    </table>
    </div>
    </div>
    {% empty %}<p>Sorry, no journeys found for {{ timetable.date }}</p>{% endfor %}
{% empty %}

<div class="map-wrapper"><div id="map"></div></div>

{% for stopusage in stopusages %}
    {% ifchanged stopusage.direction %}
        {% if not forloop.first %}</ul>{% endif %}
        <h2>
            {% if stopusage.direction == 'outbound' %}
                {% firstof service.outbound_description stopusage.direction.capitalize %}
            {% elif stopusage.direction == 'inbound' %}
                {% firstof service.inbound_description stopusage.direction.capitalize %}
            {% else %}{{ stopusage.direction.capitalize }}{% endif %}
        </h2>
        {% if has_minor_stops %}
            <input type="checkbox" id="show-all-stops-{{ forloop.counter }}" />
            <label for="show-all-stops-{{ forloop.counter }}">Show all stops</label>
        {% endif %}
        <ul class="route">
    {% endifchanged %}
    <li class="{{ stopusage.timing_status }}" itemscope itemtype="https://schema.org/BusStop">
        <a href="{{ stopusage.stop.get_absolute_url }}">
            <span itemprop="name">{{ stopusage.stop.get_qualified_name }}</span>
            <span itemprop="geo" itemscope itemtype="https://schema.org/GeoCoordinates">
                <meta itemprop="latitude" content="{{ stopusage.stop.latlong.y }}" />
                <meta itemprop="longitude" content="{{ stopusage.stop.latlong.x }}" />
            </span>
        </a>
    </li>
    {% if forloop.last %}</ul>{% endif %}
{% endfor %}

{% if object.geometry %}
    <script>window.geometry = {{ object.geometry.merged.json|safe }};</script>
{% endif %}

{% endfor %}

{% endif %}

{% if links %}
    <h2>More information</h2>
    <ul class="bulleted">
    {% for link in links %}
       <li><a href="{{ link.url }}" rel="nofollow">{{ link.text }}</a></li>
        {% endfor %}
    </ul>
{% endif %}

{% endblock %}
